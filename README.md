# BNN_SFHs
We build a Bayesian Neural Network framework to estimate the SFHs of galaxies from spectra via simulation based inference.

## 1. Generate the input (synthetic) - forward model

### 1.1. Load MILES SSP spectra with:

- Solar [M/H] and base [$\alpha$/Fe]
- Different values of [M/H] and base [$\alpha$/Fe]
- Different values of [M/H] and [$\alpha$/Fe]

Parameters:
**************
- FWMH = 2.51 $\AA$
- IMF = KU (1.3)
- BaSTI isochrones
- $\lambda$ $\in$ [3540.5,7409.6] $\AA$
- $\Delta \lambda$ = 0.9 $\AA$
- t $\in$ [0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09,  0.10,   0.15,  0.20,   0.25,  0.30,
  0.35,  0.40,   0.45  0.50,   0.60,   0.70,   0.80,   0.90,   1.00,    1.25,  1.50,   1.75,
  2.00,    2.25,  2.50,   2.75,  3.00,    3.25,  3.50,   3.75,  4.00,    4.50,   5.00,    5.50,
  6.00,    6.50,   7.00,    7.50,   8.00,    8.50,   9.00,    9.50,  10.00,   10.50,  11.00,   11.50,
 12.00,   12.50,  13.00,   13.50,  14.00 ] Gyr
- [M/H] $\in$ [-2.27, -1.79, -1.49, -1.26, -0.96, -0.66, -0.35, -0.25,  0.06,  0.15,  0.26,  0.40 ]
- [$alpha$/Fe] $\in$ [0.00,0.40]

### 1.2 Generate SFHs

We fix $M_{*}=10^{10} M_{\odot}$ and $z=0.0$

- Linear-exponential parametrization: t $\in$ [0.00,14.00] Gyr, $\Delta$ t = 0.01 Gyr, $t_0 \in$ [0.00,5.00] Gyr, 
$\Delta t_0$ = 0.05 Gyr, $\tau \in$ [$10^{-0.5}$,$10^{0.7}$] Gyr, $\Delta \tau$ = $10^{0.012}$ Gyr. In total 10.000 different SFHs for each pair [M/H], [$alpha$/Fe].


$$
S F R\left(t, t_0, \tau\right)=\Theta\left(t-t_0\right)\left(\left(t-t_0\right) / \tau\right) e^{-\left(t-t_0\right) / \tau}
$$

- Non parametric SFHs: generated by the module dense_basis (GP-SFH), include a combination of SAMs, hidrodynamical simulations and stochastic SFHs. In total 10.000 different SFHs for each pair [M/H], [$alpha$/Fe].

Once we get the SFHs we integrate them to get 9 percentiles: the time at which the stellar mass becomes 10%, 20%, 30%, 40%, 50%, 60%, 70%, 80% and 90% of the total mass.

### 1.3 Get the spectra for each SFH

First, we interpolate the MILES library to get values of [M/H] in the same range but each 0.2 units, and three different values for [$alpha$/Fe]: 0.00, 0.20 and 0.40. We also get SSP spectra each 0.01 Gyr for the parametric SFHs, or, for the non-parametric SFHs, in all the bins given by the GP-SFH module, with t $\in$ [0.00,13.47] Gyr and $\Delta$t=0.013 Gyr.

For each SFH, given the values of [M/H] and [$alpha$/Fe], we combine all the MILES interpolated spectra with these values (corresponding to different ages) as:

$$ 
\text{Galaxy Spectra}(M_{tot},[M/H],[\alpha / Fe])=\sum_{t_i} \frac{M(t_i)}{M_{tot}} \cdot spectra(t_i,[M/H],[\alpha/Fe])
$$

And, as indicated above, we fix $M_{tot}=10^10 M_{\odot}$.

For example, for the non-parametric sample,  we get 10.000 SFHs for each pair [M/H], [$alpha$/Fe], so: 10.000 SFHs x 15 bins of metallicity x 3 bins of $\alpha$ enhacement = 450.000 samples.

## 2. Encode spectra
